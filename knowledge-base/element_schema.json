{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://crownmercado.ai/schemas/video-plan-element.json",
  "title": "Video Plan Element",
  "description": "Schema describing the structure and constraints for timeline elements generated by the planning AI.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "timestamp",
    "type",
    "layer"
  ],
  "properties": {
    "timestamp": {
      "description": "Appearance time in seconds from video start.",
      "type": "number",
      "minimum": 0
    },
    "duration": {
      "description": "Element length in seconds.",
      "type": "number",
      "exclusiveMinimum": 0
    },
    "type": {
      "description": "Element family identifier.",
      "type": "string",
      "enum": [
        "broll",
        "text_overlay",
        "text_animation",
        "sound_effect",
        "effect",
        "icon",
        "speaker_intro",
        "achievement_highlight",
        "section_header",
        "emphasis"
      ]
    },
    "layer": {
      "description": "Render layer in compositing stack.",
      "type": "string",
      "enum": [
        "main",
        "video",
        "overlay",
        "audio",
        "transition"
      ]
    },
    "description": {
      "description": "Human-readable prompt for asset selection (b-roll/emphasis).",
      "type": "string",
      "maxLength": 280
    },
    "content": {
      "description": "On-screen copy or structured payload for text elements.",
      "oneOf": [
        {
          "type": "string",
          "maxLength": 180
        },
        {
          "type": "object",
          "description": "Structured layout for list or split overlays.",
          "additionalProperties": {
            "type": "string",
            "maxLength": 120
          }
        }
      ]
    },
    "style": {
      "description": "Text or graphic style variant.",
      "type": "string",
      "enum": [
        "highlighted_background",
        "clean_minimal",
        "bold_emphasis",
        "split_column",
        "callout_box",
        "simple_text",
        "section_box"
      ]
    },
    "animation": {
      "description": "Animation preset applied to text or graphic elements.",
      "type": "string",
      "enum": [
        "fade_in",
        "fade_in_list",
        "count_up",
        "typing_effect",
        "flow_chart",
        "progression_arrow",
        "expansion_flow",
        "pulse"
      ]
    },
    "sound": {
      "description": "Sound effect asset identifier.",
      "type": "string",
      "enum": [
        "transition_rewind",
        "whoosh_standard",
        "ui_pop",
        "money",
        "success",
        "fire",
        "achievement",
        "crash",
        "money_loss",
        "typing",
        "confusion",
        "expansion",
        "emphasis_ding",
        "heartbeat_soft"
      ]
    },
    "action": {
      "description": "Transition or motion instruction for effects.",
      "type": "string",
      "enum": [
        "zoom_in",
        "zoom_out",
        "fade",
        "slide_left",
        "slide_right",
        "push_in",
        "camera_shake"
      ]
    },
    "layer_priority": {
      "description": "Optional override for compositing when multiple overlay elements stack.",
      "type": "integer",
      "minimum": 0,
      "maximum": 5
    },
    "confidence": {
      "description": "Model confidence score for the element.",
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "context": {
      "description": "Short explanation of narrative intent (mirrors JSON annotations).",
      "type": "string",
      "maxLength": 200
    },
    "tags": {
      "description": "Optional set of semantic tags used for downstream matching.",
      "type": "array",
      "items": {
        "type": "string",
        "maxLength": 40
      },
      "uniqueItems": true,
      "maxItems": 8
    },
    "constraints": {
      "description": "Element-specific conditions enforced during validation.",
      "type": "object",
      "additionalProperties": {
        "type": "string"
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "type": {
            "const": "broll"
          }
        }
      },
      "then": {
        "required": [
          "description"
        ],
        "properties": {
          "layer": {
            "const": "video"
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "type": {
            "enum": [
              "text_overlay",
              "text_animation",
              "icon",
              "section_header",
              "emphasis"
            ]
          }
        }
      },
      "then": {
        "required": [
          "content"
        ],
        "properties": {
          "layer": {
            "const": "overlay"
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "type": {
            "const": "sound_effect"
          }
        }
      },
      "then": {
        "required": [
          "sound"
        ],
        "properties": {
          "layer": {
            "const": "audio"
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "type": {
            "const": "effect"
          }
        }
      },
      "then": {
        "required": [
          "action",
          "duration"
        ],
        "properties": {
          "layer": {
            "const": "transition"
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "type": {
            "enum": [
              "speaker_intro",
              "achievement_highlight"
            ]
          }
        }
      },
      "then": {
        "properties": {
          "layer": {
            "const": "main"
          }
        }
      }
    }
  ]
}
